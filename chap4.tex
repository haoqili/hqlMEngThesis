%% This is an example first chapter.  You should put chapter/appendix that you
%% write into a separate file, and add a line \include{yourfilename} to
%% main.tex, where `yourfilename.tex' is the name of the chapter/appendix file.
%% You can process specific files by typing their names in at the 
%% \files=
%% prompt when you run the file main.tex through LaTeX.
\chapter{CameraDP Android Application}
* NO discussion on hysteresis (it's discussed in previous section)
* Region width - leader spacing --- where is that?

The DIPLOMA design introduces a leader in each of the regions.  The leaders take care of all the requests coming from all phones (clients) in the region.  When a phone takes a new photo, it broadcasts the photo data to its leader, where the photo is saved. When a phone requests a photo from Region X, this request is broadcasted to its leader, which in turn uses DIPLOMA to relay the request and receive Region X’s photo data from X’s leader.

The code is divided into three big components: 

1.  StatusActivity.java for UI and client processing
2.  UserApp.java for leader and remote leader functions
3.  The DIPLOMA java files: Mux.java, VCoreDaemon.java, DSMLayer.java are unchanged.

** TODO: Add to this!!**

StatusActivity.java contains listeners for the button presses that send requests to its region leader and a handler that processes replies from the region leader. Each phone has a unique id based on its IP address that can help a region’s leader distinguish the non-leader phones in its region.  

Pressing the button that takes a picture triggers that button’s listener to retrieve the photo information from the Camera SurfaceView. The photo data is then put into a packet along with the phone’s ID, the phone’s region number, and type of request (UploadPhoto). This packet is serialized inside StatusActivity.java into a UDP broadcast that reaches the leader of the region.

Similarly, pressing a button that requests the newest photo from region X triggers the request buttons’ listener to get information on the target region number that the user is requesting. A UDP packet consisting of the phone’s ID, the phone’s region number, the target region number, and the type of request (DownloadPhoto). Again, StatusActivity.java broadcasts this packet to the leader of the region.

Let Original Leader (OL) be the leader of the phone that made the request. 

OL’s UserApp.java:handleClientRequest processes the UDP packet by the type of request. In both cases, OL sends a DIPLOMA DSM atom request, along with the additional information from the UDP packet, to the Remote Leader (RL). In the UploadPhoto case, RL is the same as the OL, since new photos are processed locally. In the DownloadPhoto case, RL is the leader of the target region. RL’s UserApp.java:handleDSMRequest processes the DSM atom request from the OL. For UploadPhoto, the photo info is saved in RL’s DIPLOMA memory as the first element of an ArrayList. (For the experiment, we only save one photo at a time. But theoretically, there is no limit to the number of photos that can be saved.) The reverse happens for DownloadPhoto, where RL retrieves the newest photo from its DIPLOMA memory.  In both cases, RL sends a reply back to the OL, arriving at OL’s UserApp.java:handleDSMReply which sends a UDP packet containing DIPLOMA latency and a success boolean, and also the photo data in the case of DownloadPhoto, back to the original non-leader.

Finally back to the original phone, its StatusActivity.java handler gets the UDP reply from OL and logs the replies. In the case of DownloadPhoto, the remote region’s newest photo is displayed.

* I don’t think the UI of leader showing new photos from nonleaders is important to write about

NO Leader transitions

 Other things
---------------
To avoid confusion and inconsistency of the region numbers, phone buttons only work if the phone is in a LEADER or NONLEADER state.  To avoid double-sending a request (and possibly crash the camera surface view), a ProgressDialog is shown until the client has received a leader reply or until a timeout. 
